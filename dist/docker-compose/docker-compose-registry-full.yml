version: '3'

services:

  tenant-manager:
    image: 'quarkus/tenant-manager-fast-jar:${TENANT_MANAGER_VERSION}'
    ports:
      - "8081:8585"
    environment:
      AUTH_ENABLED: ${AUTH_ENABLED}
      AUTHZ_ENABLED: ${AUTHZ_ENABLED}
      TENANT_MANAGER_AUTHZ_ENABLED: ${AUTH_ENABLED}
      KEYCLOAK_URL: ${KEYCLOAK_URL}
      KEYCLOAK_REALM: ${KEYCLOAK_REALM}
      KEYCLOAK_API_CLIENT_ID: ${KEYCLOAK_API_CLIENT_ID}
      QUARKUS_PROFILE: ${QUARKUS_PROFILE}

  apicurio-sr-fleet-manager:
    image: 'quarkus/srs-fleet-manager-parent-jvm:${FLEET_MANAGER_VERSION}'
    ports:
      - '8082:8080'
    environment:
      JAVA_TOOL_OPTIONS: '-Djava.net.preferIPv4Stack=true'

      TENANT_MANAGER_AUTH_SERVER_URL: ${KEYCLOAK_URL}
      TENANT_MANAGER_AUTH_REALM: ${KEYCLOAK_REALM}
      TENANT_MANAGER_AUTH_CLIENT_ID: ${KEYCLOAK_API_CLIENT_ID}
      TENANT_MANAGER_AUTH_SECRET: ${TENANT_MANAGER_AUTH_SECRET}
      QUARKUS_PROFILE: ${QUARKUS_PROFILE}

      AUTH_ENABLED: ${AUTH_ENABLED}
      KEYCLOAK_URL: ${KEYCLOAK_URL}
      KEYCLOAK_REALM: ${KEYCLOAK_REALM}
      KEYCLOAK_API_CLIENT_ID: ${KEYCLOAK_API_CLIENT_ID}

  registry-app:
    image: 'apicurio/apicurio-registry-mem:${REGISTRY_VERSION}'
    ports:
      - "8080:8080"
    environment:
      REGISTRY_ENABLE_MULTITENANCY: 'true'
      AUTHZ_ENABLED: ${AUTHZ_ENABLED}
      AUTH_ENABLED: ${AUTH_ENABLED}
      KEYCLOAK_URL: ${KEYCLOAK_URL}
      KEYCLOAK_REALM: ${KEYCLOAK_REALM}
      KEYCLOAK_API_CLIENT_ID: ${KEYCLOAK_API_CLIENT_ID}
      KEYCLOAK_UI_CLIENT_ID: ${KEYCLOAK_UI_CLIENT_ID}
      QUARKUS_PROFILE: ${QUARKUS_PROFILE}
